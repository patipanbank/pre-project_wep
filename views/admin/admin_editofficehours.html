<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Edit OfficeHours</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/public/css/Admin/admin_editofficehours.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .selected {
            background-color: #d4edda !important;
            /* สีพื้นหลังของเซลล์ที่เลือก */
        }

        .bg-success {
            background-color: #28a745 !important;
            /* สีพื้นหลังของเซลล์ที่อัปเดตแล้ว */
        }

        .bg-secondary {
            background-color: #6c757d !important;
            /* สีพื้นหลังของเซลล์ที่อัปเดต Leave */
        }
    </style>

</head>

<body>
    <nav><img src="/public/img/Header-School-IT-MFU_Thai.png" alt=""></nav>

    <nav class="navbar navbar-light navbar-expand-lg" style="background-color: #253b6d;">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" style="color: white;" aria-current="page"
                            href="/admin/homepage">HOME</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" style="color: white;" href="/admin/manage">MANAGE
                            TEACHER</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" style="color: white;" href="/admin/officehours">OFFICE HOURS</a>
                    </li>
                </ul>
            </div>
            <div>
                <button type="button" class="btn btn-danger" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-3">
                <div style="text-align: center;">
                    <img id="imgt" src="" alt="Profile Image"
                        style="width: 150px; display: block; margin-left: auto; margin-right: auto; margin-top: 20px;">
                    <p id="prof-name" class="mt-2 mb-0 fs-6"></p>
                    <p id="prof-email" class="mt-2 mb-0 fs-6"></p>
                    <p id="prof-major" class="mt-2 mb-0 fs-6"></p>
                    <p id="prof-tel" class="mt-2 mb-0 fs-6"></p>
                </div>
            </div>
            <div class="col-md-9 coltable">
                <div class="d-flex justify-content-end" style="margin-bottom: 10px; margin-top: 10px;">
                    <i class="fa fa-calendar" style="margin-right: 5px;">
                        <input type="text" id="datepicker">
                    </i>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col" style="float: inline-start;">Time/Day</th>
                                <th scope="col" class="clickable">08:00-08:30</th>
                                <th scope="col" class="clickable">08:30-09:00</th>
                                <th scope="col" class="clickable">09:00-09:30</th>
                                <th scope="col" class="clickable">09:30-10:00</th>
                                <th scope="col" class="clickable">10:00-10:30</th>
                                <th scope="col" class="clickable">10:30-11:00</th>
                                <th scope="col" class="clickable">11:00-11:30</th>
                                <th scope="col" class="clickable">11:30-12:00</th>
                                <th scope="col" class="clickable">12:00-12:30</th>
                                <th scope="col" class="clickable">12:30-13:00</th>
                                <th scope="col" class="clickable">13:00-13:30</th>
                                <th scope="col" class="clickable">13:30-14:00</th>
                                <th scope="col" class="clickable">14:00-14:30</th>
                                <th scope="col" class="clickable">14:30-15:00</th>
                                <th scope="col" class="clickable">15:00-15:30</th>
                                <th scope="col" class="clickable">15:30-16:00</th>
                                <th scope="col" class="clickable">16:00-16:30</th>
                                <th scope="col" class="clickable">16:30-17:00</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleTableBody">
                            <!-- Rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="bt mt-5">
            <button id="update-office-hours-btn" class="bg-success"
                style="color: white; border: none; font-weight: bold; border-radius: 5%; height: 40px; margin-right: 20px;"
                type="button">Update Office Hours</button>
            <button id="update-leave-btn" class="bg-secondary"
                style="color: white; border: none; font-weight: bold; border-radius: 5%; height: 40px; margin-right: 20px;"
                type="button">Update Leave</button>
            <button id="clear-btn" class="bg-info"
                style="color: rgb(255, 255, 255); font-weight: bold; border: none; border-radius: 5%; height: 40px; margin-right: 20px;"
                type="button">Clear</button>
            <button id="clearall-btn" class="bg-primary"
                style="color: rgb(255, 255, 255); font-weight: bold; border: none; border-radius: 5%; height: 40px; margin-right: 20px;"
                type="button">Clear All</button>
        </div>
    </div>

    <script>

        $(document).ready(function () {
            const data_id = new URLSearchParams(window.location.search).get('data_id'); // Get data_id from URL

            fetch(`/data/images/${data_id}`)
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        // Update the image, name, and telephone fields with fetched data
                        $('#imgt').attr('src', data.image);
                        $('#prof-name').text(data.name);
                        $('#prof-email').text(data.email);
                        $('#prof-major').text(data.major);
                        $('#prof-tel').text(data.tel);
                    }
                })
                .catch(error => console.error('Error fetching profile data:', error));

            // Add event listener for cell clicks
            $(document).on('click', 'td', function () {
                // Get the current class of the cell
                var currentClass = $(this).attr('class');

                // If the cell has 'bg-success' or 'bg-secondary', change it to 'bg-warning'
                if (currentClass.includes('bg-success') || currentClass.includes('bg-secondary')) {
                    $(this).removeClass('bg-success bg-secondary').addClass('bg-warning');
                } else if (currentClass.includes('bg-warning')) {
                    // Toggle 'bg-warning' if it's already present
                    $(this).removeClass('bg-warning');
                } else {
                    // Add 'bg-warning' if it's not present
                    $(this).addClass('bg-warning');
                }
            });

            // When the 'Update Office Hours' button is clicked
            $("#update-office-hours-btn").click(function () {
                // Change all cells with 'bg-warning' to 'bg-success'
                $("td.bg-warning").removeClass("bg-warning").addClass("bg-success");
            });

            // When the 'Update Leave' button is clicked
            $("#update-leave-btn").click(function () {
                // Change all cells with 'bg-warning' to 'bg-secondary'
                $("td.bg-warning").removeClass("bg-warning").addClass("bg-secondary");
            });

            // When the 'Clear' button is clicked
            $("#clear-btn").click(function () {
                // Remove the 'bg-warning' class from all selected cells
                $("td.bg-warning").removeClass("bg-warning");
            });

            // When the 'Clear All' button is clicked
            $("#clearall-btn").click(function () {
                // Remove both 'bg-success' and 'bg-secondary' classes from all cells
                $("td").removeClass("bg-warning bg-success bg-secondary");
            });

        });

        flatpickr("#datepicker", {
            mode: "range"
        });

        $(document).ready(function () {
            const tableBody = $('#scheduleTableBody');

            const data_id = new URLSearchParams(window.location.search).get('data_id'); // Get data_id from URL

            fetch(`/schedules/${data_id}`)
                .then(response => response.json())
                .then(schedules => {
                    // Assuming you have a timeslots array fetched or defined elsewhere
                    const timeslots = [

                        // Monday
                        { timeslots_id: 1, start_time: '08:00:00', end_time: '08:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 2, start_time: '08:30:00', end_time: '09:00:00', dayofweek: 'Monday' },
                        { timeslots_id: 3, start_time: '09:00:00', end_time: '09:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 4, start_time: '09:30:00', end_time: '10:00:00', dayofweek: 'Monday' },
                        { timeslots_id: 5, start_time: '10:00:00', end_time: '10:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 6, start_time: '10:30:00', end_time: '11:00:00', dayofweek: 'Monday' },
                        { timeslots_id: 7, start_time: '11:00:00', end_time: '11:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 8, start_time: '11:30:00', end_time: '12:00:00', dayofweek: 'Monday' },
                        { timeslots_id: 9, start_time: '12:00:00', end_time: '12:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 10, start_time: '12:30:00', end_time: '13:00:00', dayofweek: 'Monday' },
                        { timeslots_id: 11, start_time: '13:00:00', end_time: '13:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 12, start_time: '13:30:00', end_time: '14:00:00', dayofweek: 'Monday' },
                        { timeslots_id: 13, start_time: '14:00:00', end_time: '14:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 14, start_time: '14:30:00', end_time: '15:00:00', dayofweek: 'Monday' },
                        { timeslots_id: 15, start_time: '15:00:00', end_time: '15:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 16, start_time: '15:30:00', end_time: '16:00:00', dayofweek: 'Monday' },
                        { timeslots_id: 17, start_time: '16:00:00', end_time: '16:30:00', dayofweek: 'Monday' },
                        { timeslots_id: 18, start_time: '16:30:00', end_time: '17:00:00', dayofweek: 'Monday' },

                        // Tursday
                        { timeslots_id: 19, start_time: '08:00:00', end_time: '08:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 20, start_time: '08:30:00', end_time: '09:00:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 21, start_time: '09:00:00', end_time: '09:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 22, start_time: '09:30:00', end_time: '10:00:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 23, start_time: '10:00:00', end_time: '10:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 24, start_time: '10:30:00', end_time: '11:00:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 25, start_time: '11:00:00', end_time: '11:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 26, start_time: '11:30:00', end_time: '12:00:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 27, start_time: '12:00:00', end_time: '12:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 28, start_time: '12:30:00', end_time: '13:00:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 29, start_time: '13:00:00', end_time: '13:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 30, start_time: '13:30:00', end_time: '14:00:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 31, start_time: '14:00:00', end_time: '14:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 32, start_time: '14:30:00', end_time: '15:00:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 33, start_time: '15:00:00', end_time: '15:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 34, start_time: '15:30:00', end_time: '16:00:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 35, start_time: '16:00:00', end_time: '16:30:00', dayofweek: 'Tuesday' },
                        { timeslots_id: 36, start_time: '16:30:00', end_time: '17:00:00', dayofweek: 'Tuesday' },

                        // Wednesday
                        { timeslots_id: 37, start_time: '08:00:00', end_time: '08:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 38, start_time: '08:30:00', end_time: '09:00:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 39, start_time: '09:00:00', end_time: '09:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 40, start_time: '09:30:00', end_time: '10:00:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 41, start_time: '10:00:00', end_time: '10:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 42, start_time: '10:30:00', end_time: '11:00:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 43, start_time: '11:00:00', end_time: '11:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 44, start_time: '11:30:00', end_time: '12:00:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 45, start_time: '12:00:00', end_time: '12:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 46, start_time: '12:30:00', end_time: '13:00:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 47, start_time: '13:00:00', end_time: '13:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 48, start_time: '13:30:00', end_time: '14:00:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 49, start_time: '14:00:00', end_time: '14:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 50, start_time: '14:30:00', end_time: '15:00:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 51, start_time: '15:00:00', end_time: '15:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 52, start_time: '15:30:00', end_time: '16:00:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 53, start_time: '16:00:00', end_time: '16:30:00', dayofweek: 'Wednesday' },
                        { timeslots_id: 54, start_time: '16:30:00', end_time: '17:00:00', dayofweek: 'Wednesday' },

                        // Thursday
                        { timeslots_id: 55, start_time: '08:00:00', end_time: '08:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 56, start_time: '08:30:00', end_time: '09:00:00', dayofweek: 'Thursday' },
                        { timeslots_id: 57, start_time: '09:00:00', end_time: '09:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 58, start_time: '09:30:00', end_time: '10:00:00', dayofweek: 'Thursday' },
                        { timeslots_id: 59, start_time: '10:00:00', end_time: '10:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 60, start_time: '10:30:00', end_time: '11:00:00', dayofweek: 'Thursday' },
                        { timeslots_id: 61, start_time: '11:00:00', end_time: '11:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 62, start_time: '11:30:00', end_time: '12:00:00', dayofweek: 'Thursday' },
                        { timeslots_id: 63, start_time: '12:00:00', end_time: '12:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 64, start_time: '12:30:00', end_time: '13:00:00', dayofweek: 'Thursday' },
                        { timeslots_id: 65, start_time: '13:00:00', end_time: '13:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 66, start_time: '13:30:00', end_time: '14:00:00', dayofweek: 'Thursday' },
                        { timeslots_id: 67, start_time: '14:00:00', end_time: '14:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 68, start_time: '14:30:00', end_time: '15:00:00', dayofweek: 'Thursday' },
                        { timeslots_id: 69, start_time: '15:00:00', end_time: '15:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 70, start_time: '15:30:00', end_time: '16:00:00', dayofweek: 'Thursday' },
                        { timeslots_id: 71, start_time: '16:00:00', end_time: '16:30:00', dayofweek: 'Thursday' },
                        { timeslots_id: 72, start_time: '16:30:00', end_time: '17:00:00', dayofweek: 'Thursday' },

                        // Friday
                        { timeslots_id: 73, start_time: '08:00:00', end_time: '08:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 74, start_time: '08:30:00', end_time: '09:00:00', dayofweek: 'Friday' },
                        { timeslots_id: 75, start_time: '09:00:00', end_time: '09:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 76, start_time: '09:30:00', end_time: '10:00:00', dayofweek: 'Friday' },
                        { timeslots_id: 77, start_time: '10:00:00', end_time: '10:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 78, start_time: '10:30:00', end_time: '11:00:00', dayofweek: 'Friday' },
                        { timeslots_id: 79, start_time: '11:00:00', end_time: '11:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 80, start_time: '11:30:00', end_time: '12:00:00', dayofweek: 'Friday' },
                        { timeslots_id: 81, start_time: '12:00:00', end_time: '12:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 82, start_time: '12:30:00', end_time: '13:00:00', dayofweek: 'Friday' },
                        { timeslots_id: 83, start_time: '13:00:00', end_time: '13:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 84, start_time: '13:30:00', end_time: '14:00:00', dayofweek: 'Friday' },
                        { timeslots_id: 85, start_time: '14:00:00', end_time: '14:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 86, start_time: '14:30:00', end_time: '15:00:00', dayofweek: 'Friday' },
                        { timeslots_id: 87, start_time: '15:00:00', end_time: '15:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 88, start_time: '15:30:00', end_time: '16:00:00', dayofweek: 'Friday' },
                        { timeslots_id: 89, start_time: '16:00:00', end_time: '16:30:00', dayofweek: 'Friday' },
                        { timeslots_id: 90, start_time: '16:30:00', end_time: '17:00:00', dayofweek: 'Friday' },
                    ];

                    const timeslotMap = timeslots.reduce((acc, slot) => {
                        acc[slot.timeslots_id] = slot;
                        return acc;
                    }, {});

                    const scheduleGroups = schedules.reduce((acc, sched) => {
                        const day = timeslotMap[sched.timeslots_id]?.dayofweek || 'Unknown';
                        if (!acc[day]) {
                            acc[day] = [];
                        }
                        acc[day].push(sched);
                        return acc;
                    }, {});

                    const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];

                    daysOfWeek.forEach(day => {
                        const rowData = scheduleGroups[day] || [];
                        const date = rowData.length ? rowData[0].date : '';

                        const row = $('<tr>');
                        row.append(`<th scope="row"><div>${day}</div><div>${date}</div></th>`);
                        for (let i = 1; i <= 18; i++) { // Assuming 18 timeslots
                            const slot = rowData.find(s => timeslotMap[s.timeslots_id]?.start_time.includes(`0${i < 10 ? '0' : ''}${i}:`));
                            row.append(`<td class="${slot ? 'bg-success' : ''}"></td>`);
                        }
                        tableBody.append(row);
                    });
                })
                .catch(error => console.error('Error fetching schedules:', error));
        });

    </script>
</body>

</html>